openapi: 3.0.3
info:
  title: HOSE API
  version: 1.0.0
paths:
  # Query filtered and/or ordered list of Property summaries
  /properties:
    get:
      summary: Get a list of properties (lightweight DTOs)
      description: |
        Returns a list of properties in Ellensburg, WA. Supports filtering 
        price, availability, pet-friendliness, number of bedrooms, and 
        number of bathrooms
      parameters:
        - name: minRent
          in: query
          description: Minimum monthly rent
          required: false
          schema:
            type: integer # Stored in cents
        - name: maxRent
          in: query
          description: Maximum monthly rent
          required: false
          schema:
            type: integer # Stored in cents
        - name: bedrooms
          in: query
          description: Minimum number of bedrooms
          required: false
          schema:
            type: integer
        - name: bathrooms
          in: query
          description: Minimum number of bathrooms
          required: false
          schema:
            type: integer
        - name: petFriendly
          in: query
          description: Return only pet-friendly properties
          required: false
          schema:
            type: boolean
        - name: page
          in: query
          description: Page number for pagination (default 1)
          required: false
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: Number of items per page (default 20)
          required: false
          schema:
            type: integer
            default: 20
        - name: sortRent
          in: query
          description: Optional sorting of properties by rent. Use `asc` for lowest to highest, `desc` for highest to lowest.
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: asc
      responses:
        '200':
          description: List of property DTOs
          content:
            application/json:
              schema:
                type: object
                properties:
                  page:
                    type: integer
                    example: 1
                  limit:
                    type: integer
                    example: 20
                  total:
                    type: integer
                    example: 125
                  properties:
                    type: array
                    items:
                      $ref: '#/components/schemas/PropertyDTO'
        '400':
          description: Invalid query parameter
        '500':
          description: Internal server error
    post:
      summary: Create a new property
      description: Create a new property listing (authenticated users only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Property'
      responses:
        '201':
          description: Property created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Property'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '400':
          description: Invalid input

          
  # Query full property data by ID
  /properties/{propertyID}:
    get:
      summary: Get full property details by ID
      description: |
        Returns full details for a single property, including lease agreements, rooms, pet policy, 
        distance to CWU, and other attributes. The `propertyID` path parameter is the Postgres auto-incremented primary key.
      parameters:
        - name: propertyID
          in: path
          description: Unique property identifier (integer primary key)
          required: true
          schema:
            type: integer
            example: 123
      responses:
        '200':
          description: Full property object
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Property'
        '404':
          description: Property not found
        '500':
          description: Internal server error


    patch:
      summary: Update a property
      description: Modify an existing property. Only accessible to authenticated admin users.
      security:
        - bearerAuth: []
      parameters:
        - name: propertyID
          in: path
          required: true
          description: ID of the property to update
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Property'
      responses:
        '200':
          description: Property updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Property'
        '400':
          description: Invalid input
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Property not found
        '500':
          description: Internal server error


    delete:
      summary: Delete a property
      description: Remove a property by ID. Only accessible to authenticated admin users.
      security:
        - bearerAuth: []
      parameters:
        - name: propertyID
          in: path
          required: true
          description: ID of the property to delete
          schema:
            type: integer
      responses:
        '204':
          description: Property deleted successfully (no content)
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Property not found
        '500':
          description: Internal server error


  /properties/{propertyID}/images:
    post:
      summary: Upload a new image for a property
      description: Admin-only endpoint to add an image to a property.
      security:
        - bearerAuth: []
      parameters:
        - name: propertyID
          in: path
          required: true
          description: Property ID to which the image will be added
          schema:
            type: integer
            example: 123
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: The image file to upload
                altText:
                  type: string
                  description: Optional alt text for accessibility
            encoding:
              file:
                contentType: image/jpeg, image/png
      responses:
        '201':
          description: Image uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PropertyImage'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Property not found


  /properties/{propertyID}/images/{imageID}:
    delete:
      summary: Delete an image from a property
      description: Admin-only endpoint to remove an image.
      security:
        - bearerAuth: []
      parameters:
        - name: propertyID
          in: path
          required: true
          description: Property ID
          schema:
            type: integer
            example: 123
        - name: imageID
          in: path
          required: true
          description: ID of the image to delete
          schema:
            type: integer
            example: 42
      responses:
        '204':
          description: Image deleted successfully (no content)
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Property or image not found


  /properties/{propertyID}/images/{imageID}/thumbnail:
    put:
      summary: Set a property image as the thumbnail
      description: Admin-only endpoint to mark a specific image as the property's thumbnail. Automatically unsets any previous thumbnail.
      security:
        - bearerAuth: []
      parameters:
        - name: propertyID
          in: path
          required: true
          description: Property ID
          schema:
            type: integer
            example: 123
        - name: imageID
          in: path
          required: true
          description: ID of the image to set as thumbnail
          schema:
            type: integer
            example: 42
      responses:
        '200':
          description: Thumbnail set successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PropertyImage'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Property or image not found

  
  /destinations/geo:
    get:
      summary: Get destinations as GeoJSON for interactive map
      description: |
        Returns all destinations (properties, bus stops, CWU, etc.) within a bounding box in GeoJSON format.
        Optional filtering by destination type and property attributes. Property filters only apply if `type=property` or type is not specified.
      parameters:
        - name: sw_lat
          in: query
          required: true
          description: Southwest latitude of bounding box
          schema:
            type: number
            format: float
        - name: sw_lng
          in: query
          required: true
          description: Southwest longitude of bounding box
          schema:
            type: number
            format: float
        - name: ne_lat
          in: query
          required: true
          description: Northeast latitude of bounding box
          schema:
            type: number
            format: float
        - name: ne_lng
          in: query
          required: true
          description: Northeast longitude of bounding box
          schema:
            type: number
            format: float
        - name: type
          in: query
          required: false
          description: Filter by destination type. If omitted, all types are returned. Property filters only apply if `type=property`.
          schema:
            type: string
            enum: [property, cwu, bus_stop, other]
        # Property-specific filters (only applied to destinations where type=property)
        - name: minRent
          in: query
          required: false
          description: Minimum rent in cents (applied only to properties)
          schema:
            type: integer
        - name: maxRent
          in: query
          required: false
          description: Maximum rent in cents (applied only to properties)
          schema:
            type: integer
        - name: bedrooms
          in: query
          required: false
          description: Minimum number of bedrooms (applied only to properties)
          schema:
            type: integer
        - name: bathrooms
          in: query
          required: false
          description: Minimum number of bathrooms (applied only to properties)
          schema:
            type: integer
        - name: petFriendly
          in: query
          required: false
          description: Filter only pet-friendly properties (applied only to properties)
          schema:
            type: boolean
      responses:
        '200':
          description: GeoJSON FeatureCollection of destinations
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GeoJSONFeatureCollection'
        '400':
          description: Invalid query parameters
        '500':
          description: Internal server error


components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
    PropertyDTO:
      type: object
      description: Lightweight representation of a property
      required:
        - id
        - address
        - rent
        - bedrooms
        - bathrooms
        - petFriendly
      properties:
        id:
          type: integer
          description: Unique property identifier
          example: 123
        name:
          type: string
          example: "Pine Street Apartments"
        address:
          type: string
          example: "123 Pine St, Ellensburg, WA"
        rent:
          type: integer # Stored in cents
          example: 85000 # $850.00
        bedrooms:
          type: integer
          example: 2
        bathrooms:
          type: integer
          example: 1
        petFriendly:
          type: boolean
          example: true
        thumbnailUrl:
          type: string
          example: "/images/prop_123.jpg"

    Property:
      type: object
      description: Full representation of a property
      required:
        - id
        - address
        - rent
        - bedrooms
        - bathrooms
        - petFriendly
      properties:
        id:
          type: integer
          description: Unique property identifier
          example: 123
        name:
          type: string
          example: "Pine Street Apartments"
        address:
          type: string
          example: "123 Pine St, Ellensburg, WA"
        rent:
          type: integer # Stored in cents
          example: 85000 # $850.00
        bedrooms:
          type: integer
          example: 2
        bathrooms:
          type: integer
          example: 1
        petPolicy:
          type: object
          properties:
            allowed:
              type: boolean
              example: true
            deposit:
              type: integer # Stored in cents
              example: 30000 # $300.00
            restrictions:
              type: string
              example: "Cats and small dogs only"
        leaseAgreements:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
                example: "12-month"
              startMonth:
                type: string
                example: "September"
              earlyTerminationFee:
                type: integer # Stored in cents
                example: 10000 # $100.00 
        distanceToCWU:
          type: object
          properties:
            walkingMiles:
              type: number
              format: float
              example: 0.8
            walkingMinutes:
              type: integer
              example: 16
        thumbnailUrl:
          type: string
          example: "/images/prop_123.jpg"
        description:
          type: string
          example: "Quiet student-friendly housing near campus."
        availability:
          type: string
          format: date
          example: "2026-09-01"
        images:
          type: array
          description: All images associated with this property
          items:
            $ref: '#/components/schemas/PropertyImage'
      
    PropertyImage:
      type: object
      required:
        - id
        - imageUrl
        - isThumbnail
      properties:
        id:
          type: integer
          example: 42
        imageUrl:
          type: string
          example: "/images/prop_123_1.jpg"
        altText:
          type: string
          description: Text description for accessibility
          example: "Front view of Pine Street Apartments"
        isThumbnail:
          type: boolean
          example: true
        uploadedAt:
          type: string
          format: date-time
          example: "2026-01-16T12:34:56Z"

    GeoJSONFeatureCollection:
      type: object
      required:
        - type
        - features
      properties:
        type:
          type: string
          example: FeatureCollection
        features:
          type: array
          items:
            $ref: '#/components/schemas/GeoJSONFeature'

    GeoJSONFeature:
      type: object
      required:
        - type
        - geometry
        - properties
      properties:
        type:
          type: string
          example: Feature
        geometry:
          type: object
          required:
            - type
            - coordinates
          properties:
            type:
              type: string
              example: Point
            coordinates:
              type: array
              items:
                type: number
              example: [-120.546, 46.996]
        properties:
          type: object
          description: >
            Minimal information for fast map loading. Includes id, name, type, and optional description.
          required:
            - id
            - name
            - type
          properties:
            id:
              type: integer
              example: 123
            name:
              type: string
              example: "Pine Street Apartments"
            type:
              type: string
              enum: [property, cwu, bus_stop, other]
            description:
              type: string
              example: "Quiet student-friendly housing near campus."
            thumbnailUrl:
              type: string
              example: "/images/prop_123.jpg"